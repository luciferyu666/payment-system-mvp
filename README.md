ğŸ’³ é‡‘æµç³»çµ± MVP âš¡ Payment System MVP

![alt text](image.png)

ğŸš€ å°ˆæ¡ˆåç¨±ï¼š Payment System MVP  
ğŸ“Œ ç‰ˆæœ¬ï¼š v1.0  
ğŸ“… æœ€å¾Œæ›´æ–°æ—¥æœŸï¼š 2025-03-05

æœ¬å°ˆæ¡ˆç‚º SPEC-004: é‡‘æµç³»çµ±æ¶æ§‹è¨­è¨ˆ çš„ æœ€å°å¯ç”¨ç”¢å“ (MVP, Minimum Viable Product)ï¼Œæ•´åˆ å®¢æ¨‚å¾— (KPay) èˆ‡ å°ç£é‡Œ (TPay) é‡‘æµï¼Œæä¾›çµ±ä¸€çš„æ”¯ä»˜ä»‹é¢ï¼Œä¸¦æ”¯æ´ Webhook é©—è­‰ã€äº¤æ˜“æŸ¥è©¢ã€RBAC æ¬Šé™ç®¡ç†ï¼Œç¢ºä¿é‡‘æµäº¤æ˜“çš„å®‰å…¨æ€§èˆ‡ç©©å®šæ€§ã€‚

ğŸ¯ å°ˆæ¡ˆç›®æ¨™
âœ… æ•´åˆ å®¢æ¨‚å¾—ã€å°ç£é‡Œ é‡‘æµï¼Œæä¾›çµ±ä¸€ `PaymentProvider` ä»‹é¢  
âœ… æ”¯æ´ Webhook ç°½ç« é©—è­‰ï¼ˆHMACï¼‰ï¼Œç¢ºä¿äº¤æ˜“å®‰å…¨  
âœ… é€é RBAC æ¬Šé™ç®¡ç†ï¼Œä¿è­· API å­˜å–æ¬Šé™  
âœ… MySQL + Redis å¿«å–ï¼Œæå‡äº¤æ˜“æŸ¥è©¢æ•ˆèƒ½  
âœ… Docker + Kubernetes éƒ¨ç½²ï¼Œç¢ºä¿ç³»çµ±å¯æ“´å±•

```
âš™ï¸ æŠ€è¡“æ¶æ§‹
ğŸ’» å¾Œç«¯
âš¡ æ¡†æ¶ï¼š NestJS (Node.js + TypeScript)
âš¡ è³‡æ–™åº«ï¼š MySQLï¼ˆäº¤æ˜“è¨˜éŒ„ï¼‰ã€Redisï¼ˆå¿«å–äº¤æ˜“çµ±è¨ˆï¼‰
âš¡ èº«ä»½é©—è­‰ï¼š JWTï¼ˆJSON Web Tokenï¼‰
âš¡ é‡‘æµ API ä»‹æ¥ï¼š å®¢æ¨‚å¾— (KPay)ã€å°ç£é‡Œ (TPay)
âš¡ Webhook é©—è­‰ï¼š HMAC ç°½ç« é©—è­‰ + Exponential Backoff é‡è©¦
âš¡ æ—¥èªŒç›£æ§ï¼š ELK (Elasticsearch, Logstash, Kibana) / Loki
âš¡ éƒ¨ç½²ï¼š Docker + Kubernetes (K8s)

ğŸ’» å‰ç«¯
âš¡ æ¡†æ¶ï¼š Vue 3 + Pinia
âš¡ API å‘¼å«ï¼š Axios / Fetch
âš¡ å³æ™‚é€šçŸ¥ï¼š WebSocket / SSE
âš¡ UI æ¡†æ¶ï¼š Element Plus
```

```
ğŸ“‚ å°ˆæ¡ˆç›®éŒ„çµæ§‹
payment-system-mvp/
â”œâ”€â”€ backend/ # ğŸš€ å¾Œç«¯æœå‹™ (NestJS)
â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”œâ”€â”€ auth/ # ğŸ”‘ èº«ä»½é©—è­‰ (JWT + RBAC)
â”‚ â”‚ â”œâ”€â”€ payment/ # ğŸ’³ é‡‘æµæ¨¡çµ„ (å®¢æ¨‚å¾—ã€å°ç£é‡Œ)
â”‚ â”‚ â”œâ”€â”€ order/ # ğŸ“¦ è¨‚å–®ç®¡ç†
â”‚ â”‚ â”œâ”€â”€ common/ # ğŸ”§ å…±ç”¨æ¨¡çµ„ (éŒ¯èª¤è™•ç†ã€API é™æµ)
â”‚ â”‚ â”œâ”€â”€ database/ # ğŸ—„ è³‡æ–™åº«æ¨¡çµ„ (MySQL + Redis)
â”‚ â”œâ”€â”€ .env.example # ğŸ›  ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”‚ â”œâ”€â”€ docker-compose.yml # ğŸ³ Docker è¨­å®š
â”‚ â””â”€â”€ README.md
â”‚
â”œâ”€â”€ frontend/ # ğŸ¨ å‰ç«¯ (Vue 3)
â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”œâ”€â”€ components/ # å¯é‡è¤‡ä½¿ç”¨çš„ UI å…ƒä»¶
â”‚ â”‚ â”œâ”€â”€ views/ # é é¢
â”‚ â”‚ â”œâ”€â”€ api/ # API å‘¼å«
â”‚ â”œâ”€â”€ README.md
â”‚
â”œâ”€â”€ deployment/ # ğŸš€ CI/CD èˆ‡éƒ¨ç½²
â”‚ â”œâ”€â”€ k8s/ # Kubernetes è¨­å®š
â”‚ â”œâ”€â”€ github-actions/ # GitHub Actions CI/CD
â”‚ â”œâ”€â”€ README.md
â”‚
â”œâ”€â”€ docs/ # ğŸ“– æ–‡ä»¶
â”‚ â”œâ”€â”€ api-spec.yaml # OpenAPI / Swagger è¦æ ¼
â”‚ â”œâ”€â”€ architecture.md # ç³»çµ±æ¶æ§‹è¨­è¨ˆ
â”‚ â”œâ”€â”€ README.md
â”‚
â””â”€â”€ README.md # ğŸ“Œ å°ˆæ¡ˆèªªæ˜
```

2ï¸âƒ£ å•Ÿå‹•å¾Œç«¯
cd backend
npm install
npm run start

3ï¸âƒ£ å•Ÿå‹•å‰ç«¯
cd frontend
npm install
npm run dev

4ï¸âƒ£ å•Ÿå‹• Docker (æœ¬åœ°é–‹ç™¼)
dockerâš¡compose up âš¡d

ğŸ“Œ API è¨­è¨ˆ  
ğŸ”‘ èº«ä»½é©—è­‰ APIï¼ˆAuth APIï¼‰
âœ… `POST /auth/login`

- ğŸ”¹ æè¿°ï¼šç”¨æˆ¶ç™»å…¥ï¼Œå›å‚³ JWT Token
- ğŸ”¹ è«‹æ±‚åƒæ•¸ï¼š
  - `email` (string) - ä½¿ç”¨è€… Email
  - `password` (string) - ä½¿ç”¨è€…å¯†ç¢¼

âœ… `GET /auth/profile`

- ğŸ”¹ æè¿°ï¼šå–å¾—ç™»å…¥ç”¨æˆ¶çš„å€‹äººè³‡è¨Š
- ğŸ”¹ è«‹æ±‚æ¨™é ­ï¼š
  - `Authorization: Bearer <JWT_TOKEN>`

ğŸ’³ é‡‘æµäº¤æ˜“ APIï¼ˆPayments APIï¼‰
âœ… `POST /payments`

- ğŸ”¹ æè¿°ï¼šå»ºç«‹æ”¯ä»˜äº¤æ˜“
- ğŸ”¹ è«‹æ±‚åƒæ•¸ï¼š
  - `provider` (string) - é‡‘æµæœå‹™å•† (`kpay` / `tpay`)
  - `amount` (number) - äº¤æ˜“é‡‘é¡
  - `orderId` (string) - è¨‚å–® ID

âœ… `GET /payments/:id`

- ğŸ”¹ æè¿°ï¼šæŸ¥è©¢äº¤æ˜“è©³æƒ…
- ğŸ”¹ è·¯å¾‘åƒæ•¸ï¼š
  - `id` (string) - äº¤æ˜“ ID

âœ… `POST /payments/refund/:id`

- ğŸ”¹ æè¿°ï¼šç”³è«‹é€€æ¬¾
- ğŸ”¹ è·¯å¾‘åƒæ•¸ï¼š
  - `id` (string) - äº¤æ˜“ ID

ğŸ”” Webhook API
âœ… `POST /payments/notify`

- ğŸ”¹ æè¿°ï¼šé‡‘æµ Webhook å›èª¿ï¼Œæ¥æ”¶æ”¯ä»˜çµæœé€šçŸ¥
- ğŸ”¹ è«‹æ±‚æ¨™é ­ï¼š
  - `X-Signature` (string) - HMAC ç°½ç« é©—è­‰

ğŸ“¦ è¨‚å–® APIï¼ˆOrders APIï¼‰
âœ… `POST /orders`

- ğŸ”¹ æè¿°ï¼šå»ºç«‹è¨‚å–®
- ğŸ”¹ è«‹æ±‚åƒæ•¸ï¼š
  - `items` (array) - è¨‚å–®å•†å“åˆ—è¡¨
  - `totalAmount` (number) - è¨‚å–®ç¸½é‡‘é¡

âœ… `GET /orders/:id`

- ğŸ”¹ æè¿°ï¼šæŸ¥è©¢è¨‚å–®è©³æƒ…
- ğŸ”¹ è·¯å¾‘åƒæ•¸ï¼š
  - `id` (string) - è¨‚å–® ID

âœ… `GET /orders`

- ğŸ”¹ æè¿°ï¼šæŸ¥è©¢æ‰€æœ‰è¨‚å–®ï¼ˆæ”¯æ´åˆ†é ï¼‰
- ğŸ”¹ æŸ¥è©¢åƒæ•¸ï¼š
  - `page` (number) - åˆ†é æ•¸
  - `limit` (number) - å–®é ç­†æ•¸

ğŸ” æ¸¬è©¦èˆ‡é©—æ”¶
âœ… å–®å…ƒæ¸¬è©¦ï¼ˆJestï¼‰ï¼šè¦†è“‹ APIã€é‡‘æµäº¤æ˜“ã€Webhook é©—è­‰  
âœ… æ•´åˆæ¸¬è©¦ï¼šèˆ‡é‡‘æµæ²™ç›’é€²è¡Œæ¸¬è©¦ï¼ˆæˆåŠŸã€å¤±æ•—ã€é€€æ¬¾ï¼‰  
âœ… å£“åŠ›æ¸¬è©¦ï¼ˆJMeter / k6ï¼‰ï¼šæ¨¡æ“¬å¤šç·šç¨‹äº¤æ˜“å ´æ™¯  
âœ… å®‰å…¨æ¸¬è©¦ï¼šé˜²ç¦¦ SQL Injectionã€XSSã€CSRFï¼Œç¢ºä¿ç³»çµ±å®‰å…¨

ğŸ“œ æˆæ¬Š
æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT Licenseï¼Œå¯è‡ªç”±ä½¿ç”¨èˆ‡ä¿®æ”¹ï¼Œä½†éœ€ä¿ç•™åŸå§‹ç‰ˆæ¬Šè³‡è¨Šã€‚

ğŸ“¬ è¯çµ¡æ–¹å¼
ğŸ“§ Email: vinceyue667@gmail.com
ğŸŒ å®˜æ–¹ç¶²ç«™:
